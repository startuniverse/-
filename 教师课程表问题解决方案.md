# 教师课程表问题解决方案

## 问题
```
教师端点击进入我的课表界面，点击添加课程，报错：
您还没有负责的班级，请联系管理员
添加失败: 您还没有负责的班级，请联系管理员
```

## 原因
教师账号没有负责的班级，导致无法添加课程。

## 解决方案

### 步骤1：检查当前状态
在数据库中执行：
```sql
USE education_platform;

-- 查看教师和班级关系
SELECT
    t.id as 教师ID,
    u.real_name as 教师姓名,
    c.class_name as 负责班级
FROM teacher t
JOIN user u ON t.user_id = u.id
LEFT JOIN class c ON c.head_teacher_id = t.id
WHERE t.deleted = 0;

-- 查看没有班主任的班级
SELECT id, class_name FROM class
WHERE head_teacher_id IS NULL AND deleted = 0;
```

### 步骤2：为教师分配班级

#### 方法A：使用SQL脚本（推荐）
执行修复脚本：
```sql
-- 为高一(1)班分配教师（假设教师ID为1）
UPDATE class SET head_teacher_id = 1 WHERE id = 1 AND head_teacher_id IS NULL;

-- 为高一(2)班分配教师（假设教师ID为2）
UPDATE class SET head_teacher_id = 2 WHERE id = 2 AND head_teacher_id IS NULL;
```

#### 方法B：通过管理界面
如果系统有管理界面，可以通过以下方式：
1. 登录管理员账号
2. 进入班级管理
3. 为班级设置班主任

### 步骤3：验证修复
重新执行检查SQL，确认：
- ✅ 每个班级都有班主任
- ✅ 教师都有负责的班级

### 步骤4：测试功能

#### 教师端测试
1. 登录教师账号（如 teacher1/admin）
2. 进入"我的课表"页面
3. 点击"添加课程"按钮
4. **应该能看到**：班级选择下拉框，显示班级名称
5. 填写课程信息并提交
6. **应该看到**：添加成功提示

#### 学生端测试
1. 登录学生账号（如 student1/admin）
2. 进入"课程表"页面
3. **应该看到**：教师添加的课程

## 已完成的修复

### 后端修复（TeacherController.java）
- ✅ 新增 `GET /teacher/classes` 接口
- ✅ 修复 `POST /timetable` 自动设置 classId
- ✅ 修复 `POST /timetable/batch` 自动设置 classId

### 前端修复（Timetable.vue）
- ✅ 添加班级列表加载
- ✅ 使用下拉框选择班级
- ✅ 显示班级名称而非ID

### API新增（teacher.js）
- ✅ 添加 `getTeacherClasses()` 函数

## 数据库操作

### 快速修复脚本
如果不确定教师ID和班级ID，可以使用这个脚本：

```sql
USE education_platform;

-- 查看当前对应关系
SELECT '当前教师和班级：' as '';
SELECT t.id, u.real_name, c.class_name
FROM teacher t
JOIN user u ON t.user_id = u.id
LEFT JOIN class c ON c.head_teacher_id = t.id
WHERE t.deleted = 0;

-- 查看需要分配的班级
SELECT '需要班主任的班级：' as '';
SELECT id, class_name FROM class
WHERE head_teacher_id IS NULL AND deleted = 0;

-- 手动执行修复（根据上面查询结果修改ID）
-- UPDATE class SET head_teacher_id = 教师ID WHERE id = 班级ID;
```

### 示例修复
```sql
-- 假设查询结果显示：
-- 教师1: 王老师
-- 教师2: 李老师
-- 班级1: 高一(1)班
-- 班级2: 高一(2)班

-- 执行：
UPDATE class SET head_teacher_id = 1 WHERE id = 1;
UPDATE class SET head_teacher_id = 2 WHERE id = 2;
```

## 常见问题

### Q1: 如何知道教师ID和班级ID？
A: 执行上面的查询SQL，会显示ID对应关系

### Q2: 教师可以负责多个班级吗？
A: 可以。一个教师可以是多个班级的班主任

### Q3: 如果没有班级怎么办？
A: 需要先创建班级，然后分配给教师

### Q4: 修复后还是报错？
A: 请检查：
1. 是否正确执行了UPDATE语句
2. 是否commit了事务
3. 重新登录系统再试

## 相关文件
- `E:\shixun\fix_timetable_issue.sql` - 完整诊断和修复脚本
- `E:\shixun\课程表修复说明.md` - 详细修复说明
- `E:\shixun\test_timetable_fix.js` - 测试脚本

## 联系方式
如果问题仍然存在，请提供：
1. 执行查询SQL的结果截图
2. 具体的错误信息
3. 使用的教师账号名