# 学生看不到教师添加课程的问题分析

## 问题描述
- 教师123（李）添加了课程"测试"
- 学生xuesheng（cyh）查看课程表，看不到"测试"课程

## 根本原因

### 数据分析

| 用户 | 账号 | 角色 | 班级 | 班级名称 |
|------|------|------|------|----------|
| 教师123 | 123 | 教师 | 5 | 高二(2)班 |
| 学生xuesheng | xuesheng | 学生 | 2 | 高一(2)班 |

### 课程表数据
```sql
-- 教师123添加的课程
SELECT * FROM timetable WHERE teacher_id = 5;
-- 结果：class_id = 5 (高二(2)班), subject = '测试'

-- 学生xuesheng能看到的课程
SELECT * FROM timetable WHERE class_id = 2;  -- 高一(2)班
-- 结果：只有王老师和李老师添加的课程
```

### 问题根源
**班级不匹配！**
- 教师123在 **高二(2)班** 添加课程
- 学生xuesheng在 **高一(2)班**
- 所以学生看不到教师123添加的课程

## 解决方案

### 方案1：将学生移动到教师负责的班级（推荐）

将学生xuesheng从高一(2)班移动到高二(2)班：

```sql
UPDATE user
SET class_id = 5
WHERE username = 'xuesheng';
```

**优点：**
- 简单直接
- 符合教师-学生的班级关系

**操作步骤：**
1. 执行上述SQL
2. 学生重新登录系统
3. 查看课程表，应该能看到"测试"课程

### 方案2：让教师123也负责高一(2)班

让教师123同时负责高一(2)班和高二(2)班：

```sql
-- 方法A：修改现有班级的班主任（会替换王老师）
UPDATE class SET head_teacher_id = 5 WHERE id = 2;

-- 方法B：如果系统支持多班主任，需要修改表结构
-- 当前系统不支持，需要修改代码
```

**缺点：**
- 会替换原有的班主任王老师
- 不符合实际教学安排

### 方案3：创建测试学生在高二(2)班

创建一个新的测试学生账号，在高二(2)班：

```sql
-- 创建测试学生
INSERT INTO user (username, password, real_name, class_id, status, deleted)
VALUES ('test_student', '$2a$10$...', '测试学生', 5, 1, 0);

-- 分配学生角色
INSERT INTO user_role (user_id, role_id)
SELECT u.id, r.id FROM user u, role r
WHERE u.username = 'test_student' AND r.role_code = 'USER';
```

## 验证修复

### 修复前
```sql
-- 教师123的课程
SELECT * FROM timetable WHERE teacher_id = 5;
-- class_id = 5 (高二(2)班)

-- 学生xuesheng的班级
SELECT class_id FROM user WHERE username = 'xuesheng';
-- class_id = 2 (高一(2)班)

-- 结果：不匹配，学生看不到课程
```

### 修复后（方案1）
```sql
-- 执行修复
UPDATE user SET class_id = 5 WHERE username = 'xuesheng';

-- 验证
SELECT
    u.username,
    u.class_id,
    c.class_name,
    (SELECT COUNT(*) FROM timetable t WHERE t.class_id = u.class_id AND t.deleted = 0) as 课程数
FROM user u
LEFT JOIN class c ON u.class_id = c.id
WHERE u.username = 'xuesheng';

-- 结果：class_id = 5, 课程数 = 1（包含"测试"课程）
```

## 推荐操作

### 执行修复
```sql
-- 1. 备份当前数据
CREATE TABLE user_backup AS SELECT * FROM user WHERE username = 'xuesheng';

-- 2. 执行修复
UPDATE user
SET class_id = 5
WHERE username = 'xuesheng';

-- 3. 验证修复
SELECT
    u.username,
    u.real_name,
    c.class_name as 当前班级,
    (SELECT COUNT(*) FROM timetable t WHERE t.class_id = u.class_id AND t.deleted = 0) as 可见课程数
FROM user u
LEFT JOIN class c ON u.class_id = c.id
WHERE u.username = 'xuesheng';
```

### 测试验证
1. **教师123** 登录，确认课程"测试"存在
2. **学生xuesheng** 重新登录
3. **学生xuesheng** 进入课程表页面
4. **应该能看到**：课程"测试"

## 其他注意事项

### 如果需要保留学生在高一(2)班
如果学生必须在高一(2)班，那么：
1. 需要让教师123也负责高一(2)班，或者
2. 需要让其他教师（王老师或李老师）在高一(2)班添加课程

### 测试建议
- 使用不同的测试账号进行测试
- 确保教师和学生在同一个班级
- 验证课程表的显示逻辑

## 总结

**问题：** 教师和学生不在同一个班级
**解决：** 将学生移动到教师负责的班级
**结果：** 学生可以看到教师添加的课程