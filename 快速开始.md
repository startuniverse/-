# 教师注册功能 - 快速开始

## 🎯 问题解决
**原问题**: 教师注册时学校选择显示"No data"，无法完成注册

**已解决**: ✅ 支持自动切换手动输入 + 提供学校数据脚本

---

## 🚀 快速使用（推荐）

### 方式1：使用手动输入功能（无需数据库操作）

1. **启动服务**
   ```bash
   # 后端
   cd /e/shixun/backend && mvn spring-boot:run

   # 前端
   cd /e/shixun/frontend && npm run dev
   ```

2. **访问注册页面**
   ```
   http://localhost:5173/login
   ↓
   点击"教师注册"
   ```

3. **填写表单**
   ```
   用户名: teacher01
   密码: 123
   确认密码: 123
   真实姓名: 张老师
   手机号: 13800138099
   邮箱: zhang@edu.com
   部门: 数学教研组
   职称: 高级教师
   学校: 云南大学  <-- 手动输入
   ```

4. **点击注册**
   - 系统会自动创建学校记录
   - 自动分配教师角色
   - 跳转到登录页面

5. **登录测试**
   ```
   用户名: teacher01
   密码: 123
   ```

---

### 方式2：添加预设学校数据

1. **执行SQL脚本**
   ```bash
   # 连接MySQL
   mysql -u root -p

   # 执行脚本
   source E:/shixun/backend/database/INSERT_SCHOOLS.sql;
   ```

2. **重启后端服务**
   ```bash
   # 停止后按 Ctrl+C，然后重新启动
   mvn spring-boot:run
   ```

3. **访问注册页面**
   ```
   http://localhost:5173/teacher-register
   ```

4. **选择学校**
   - 学校下拉框现在有数据了
   - 选择"云南大学"或其他学校
   - 填写其他信息并注册

---

## 📋 完整功能列表

### 登录页面
- ✅ 普通用户注册链接
- ✅ 教师注册链接（新增）

### 教师注册页面
- ✅ 完整表单验证
- ✅ 学校智能选择（下拉/手动输入）
- ✅ 自动切换输入方式
- ✅ 错误提示

### 后端接口
- ✅ `POST /auth/register/teacher` - 教师注册
- ✅ `GET /backend/school/list` - 学校列表
- ✅ 自动创建新学校（手动输入时）

---

## 🔧 数据库操作

### 查看学校数据
```sql
SELECT id, school_code, school_name, school_type
FROM school
WHERE deleted = 0;
```

### 查看教师用户
```sql
SELECT u.username, u.real_name, r.role_code
FROM user u
JOIN user_role ur ON u.id = ur.user_id
JOIN role r ON ur.role_id = r.id
WHERE r.role_code = 'TEACHER';
```

### 查看TEACHER角色
```sql
SELECT * FROM role WHERE role_code = 'TEACHER';
```

---

## 🐛 故障排除

### 问题1: 学校下拉框仍显示"No data"
**原因**: 浏览器缓存
**解决**: 按 `Ctrl + F5` 强制刷新页面

### 问题2: 注册时提示"请选择学校"
**原因**: 未选择学校也未手动输入
**解决**:
- 选择下拉框中的学校，或
- 点击"手动输入新学校"链接并输入学校名称

### 问题3: 后端启动失败
**原因**: 数据库连接问题
**解决**: 检查 `application.yml` 中的数据库配置

### 问题4: 前端无法访问
**原因**: 端口占用
**解决**: 检查5173端口是否被占用，或修改前端端口

---

## 📞 API测试

### 测试学校列表接口
```bash
curl http://localhost:8080/backend/school/list
```

### 测试教师注册（选择现有学校）
```bash
curl -X POST http://localhost:8080/auth/register/teacher \
  -H "Content-Type: application/json" \
  -d '{
    "username": "teacher02",
    "password": "123",
    "realName": "李老师",
    "phone": "13800138088",
    "email": "li@edu.com",
    "schoolId": 1,
    "department": "语文教研组",
    "title": "一级教师"
  }'
```

### 测试教师注册（手动输入新学校）
```bash
curl -X POST http://localhost:8080/auth/register/teacher \
  -H "Content-Type: application/json" \
  -d '{
    "username": "teacher03",
    "password": "123",
    "realName": "王老师",
    "phone": "13800138077",
    "email": "wang@edu.com",
    "customSchoolName": "云南大学",
    "department": "数学系",
    "title": "教授"
  }'
```

---

## 📊 数据流程图

```
教师注册页面
    ↓
填写表单 + 选择/输入学校
    ↓
提交到后端
    ↓
后端判断：
├─ 有 schoolId → 使用现有学校
└─ 有 customSchoolName → 创建新学校
    ↓
创建用户记录
    ↓
创建教师记录
    ↓
分配 TEACHER 角色
    ↓
注册成功
```

---

## ✅ 验证清单

- [ ] 能够访问登录页面
- [ ] 能够点击"教师注册"链接
- [ ] 能够填写完整表单
- [ ] 能够选择学校或手动输入
- [ ] 能够成功提交注册
- [ ] 能够使用新账号登录
- [ ] 登录后角色为TEACHER

---

## 🎓 测试账号

### 预设账号
```
管理员: admin / adminadmin
普通用户: 123 / 123
```

### 教师账号（注册后）
```
用户名: teacher01
密码: 123
角色: TEACHER
```

---

## 📝 下一步

1. **测试注册功能**
   - 访问登录页面
   - 点击"教师注册"
   - 填写表单并提交

2. **验证数据库**
   - 检查user表
   - 检查teacher表
   - 检查user_role表

3. **测试登录**
   - 使用新账号登录
   - 验证角色权限

---

## 💡 提示

- 如果数据库没有学校数据，系统会自动切换到手动输入模式
- 手动输入的学校名称会被自动创建到数据库
- 教师注册后自动分配TEACHER角色
- 可以在登录后访问 `/auth/info` 查看用户信息和角色

---

**祝使用顺利！** 🎉
