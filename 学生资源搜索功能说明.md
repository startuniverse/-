# 学生资源搜索功能 - 完整实现说明

## 功能概述

为学生用户添加资源搜索功能，允许其搜索和查看校内资源库。该资源库由管理员在后台管理界面创建和发布。

## 修改的文件清单

### 后端修改 (1个文件)

1. **`backend/src/main/java/com/education/platform/controller/ResourceController.java`**
   - 新增：`GET /resource/detail/{id}` - 查看资源详情并增加浏览次数
   - 修改：`GET /resource/list` - 新增关键词搜索参数 `keyword`

### 前端修改 (5个文件)

1. **`frontend/src/api/campus.js`**
   - 新增：`getResourceDetail(id)` - 获取资源详情API

2. **`frontend/src/views/campus/Resources.vue`** (新建)
   - 学生资源浏览页面，约670行代码

3. **`frontend/src/router/index.js`**
   - 新增：学生资源路由 `/campus/resources`

4. **`frontend/src/views/Layout.vue`**
   - 新增：侧边栏"学习资源"菜单项
   - 新增：导入 Collection 图标

5. **`frontend/src/报错.md`**
   - 更新：添加学生资源搜索功能文档

## 核心功能详解

### 1. 搜索和筛选

```javascript
// 搜索参数
{
  keyword: '',    // 关键词搜索（标题+描述）
  category: '',   // 分类：课程/视频/试卷/其他
  subject: ''     // 科目：语文/数学/英语/物理/化学/生物/历史/地理/政治/通用
}
```

**支持组合筛选**：关键词 + 分类 + 科目

### 2. 资源列表展示

**卡片式布局**，每行显示多个卡片（响应式）：
- 标题 + 分类标签
- 描述（最多2行）
- 科目、浏览次数、下载次数
- 上传时间
- 操作：下载、分享

### 3. 详情查看

点击卡片弹出对话框，显示：
- 完整标题和标签
- 详细描述
- 资源信息：上传时间、浏览次数、下载次数、文件类型、文件大小
- 底部操作：关闭、下载、分享

**重要**：查看详情会自动增加浏览次数

### 4. 资源操作

**下载资源**：
- 调用后端接口 `/resource/download/{id}`
- 自动更新下载次数
- 触发浏览器下载

**分享资源**：
- 生成分享链接（带分享码）
- 提供一键复制到剪贴板功能

### 5. 分页功能

- 每页可选：12、24、48条
- 显示总数统计
- 支持快速跳页

## 数据流转图

```
学生登录 → 点击"学习资源"菜单
    ↓
Resources.vue 页面加载
    ↓
调用 getStudentResources({ current: 1, size: 12 })
    ↓
后端：GET /resource/list
    ↓
返回已发布的资源列表（status=1）
    ↓
显示卡片列表
    ↓
学生输入关键词/选择筛选 → 重新搜索
    ↓
点击卡片 → 调用 getResourceDetail(id)
    ↓
后端：GET /resource/detail/{id}
    ↓
增加浏览次数 → 返回详情
    ↓
显示详情对话框
    ↓
点击下载 → 调用 downloadResource(id)
    ↓
后端：POST /resource/download/{id}
    ↓
更新下载次数 → 返回文件URL → 触发下载
```

## API 接口对照表

| 前端函数 | 后端接口 | 方法 | 说明 |
|---------|---------|------|------|
| `getStudentResources(params)` | `/resource/list` | GET | 获取资源列表（已发布） |
| `getResourceDetail(id)` | `/resource/detail/{id}` | GET | 查看详情+浏览计数 |
| `downloadResource(id)` | `/resource/download/{id}` | POST | 下载+下载计数 |
| `shareResource(id)` | `/resource/share` | POST | 生成分享链接 |

## 权限控制

- **访问前提**：用户必须登录（`@PreAuthorize("isAuthenticated()")`）
- **数据范围**：只显示已发布的资源（`status = 1`）
- **角色要求**：学生、家长、教师、管理员均可访问

## 界面展示

### 学生端界面

**学习资源页面**：
```
┌─────────────────────────────────────────────────┐
│  学习资源库                                    │
│  [搜索框] [搜索按钮]                           │
│  分类：[全部] [课程] [视频] [试卷] [其他]      │
│  科目：[下拉选择框] [重置按钮]                 │
├─────────────────────────────────────────────────┤
│  资源列表  共 X 个资源                         │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐            │
│  │卡片1│ │卡片2│ │卡片3│ │卡片4│            │
│  └─────┘ └─────┘ └─────┘ └─────┘            │
│  [分页控件]                                    │
└─────────────────────────────────────────────────┘
```

**详情对话框**：
```
┌─────────────────────────────────────────────────┐
│  资源详情                                      │
├─────────────────────────────────────────────────┤
│  标题：XXX                                     │
│  [分类标签] [科目标签] [文件类型标签]          │
│                                                 │
│  描述：                                        │
│  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX              │
│                                                 │
│  资源信息：                                    │
│  上传时间：2026-01-08 10:30                    │
│  浏览次数：15                                  │
│  下载次数：5                                   │
│  文件大小：2.5 MB                              │
│  文件路径：/resources/xxx.pdf                  │
├─────────────────────────────────────────────────┤
│  [关闭] [下载资源] [分享链接]                  │
└─────────────────────────────────────────────────┘
```

## 测试步骤

### 1. 管理员准备测试数据

1. 登录管理员账号
2. 进入"资源管理"
3. 添加几个测试资源：
   - 分类：课程、视频、试卷
   - 科目：语文、数学、英语
   - 状态：已发布（管理员添加自动发布）

### 2. 学生用户测试

1. **登录学生账号**
   - 使用之前注册的学生账号（如：123456 / 123）

2. **进入学习资源**
   - 点击左侧菜单"学习资源"
   - 应该能看到管理员添加的资源

3. **测试搜索功能**
   - 在搜索框输入关键词（如"数学"）
   - 按回车或点击搜索按钮
   - 筛选结果应该正确显示

4. **测试分类筛选**
   - 点击"课程"分类
   - 只显示分类为课程的资源

5. **测试科目筛选**
   - 选择"数学"科目
   - 只显示数学科目的资源

6. **测试组合筛选**
   - 关键词：测试
   - 分类：课程
   - 科目：数学
   - 应该同时满足三个条件

7. **测试详情查看**
   - 点击任意资源卡片
   - 弹出详情对话框
   - 注意浏览次数应该+1

8. **测试下载**
   - 在列表或详情中点击"下载"
   - 应该触发浏览器下载
   - 下载次数应该+1

9. **测试分享**
   - 点击"分享"按钮
   - 生成分享链接
   - 点击"复制链接"
   - 应该提示复制成功

10. **测试分页**
    - 如果资源超过12个，应该出现分页
    - 切换页码应该正确加载
    - 修改每页条数应该重新加载

### 3. 验证数据一致性

1. **浏览次数验证**
   - 学生查看详情后
   - 刷新页面或重新进入
   - 浏览次数应该增加

2. **下载次数验证**
   - 学生下载资源后
   - 刷新列表
   - 下载次数应该增加

3. **状态过滤验证**
   - 管理员创建待审核资源
   - 学生应该看不到该资源
   - 只能看到已发布的资源

## 常见问题

### Q1: 学生看不到任何资源？
**可能原因**：
- 管理员没有添加资源
- 资源状态不是"已发布"（status=1）
- 资源被删除了

**解决**：
- 让管理员添加资源并确保状态为已发布

### Q2: 搜索功能不工作？
**可能原因**：
- 后端接口未更新（缺少keyword参数）
- 前端API未正确传递参数

**解决**：
- 检查后端 `/resource/list` 是否支持keyword
- 检查前端 `campus.js` 的 `getStudentResources` 函数

### Q3: 浏览次数不增加？
**可能原因**：
- 详情接口未调用
- 前端未使用 `getResourceDetail` 函数

**解决**：
- 检查 `Resources.vue` 的 `openResourceDetail` 函数
- 确保调用了 `getResourceDetail(item.id)`

### Q4: 下载次数不增加？
**可能原因**：
- 后端接口未正确更新
- 前端未调用下载接口

**解决**：
- 检查后端 `/resource/download/{id}` 是否更新了计数
- 检查前端是否调用了 `downloadResource`

## 技术要点

### 1. Vue 3 Composition API
```javascript
const loading = ref(false)
const resourcesData = ref([])
const searchParams = ref({ keyword: '', category: '', subject: '' })

const loadResources = async () => {
  // 异步加载数据
}
```

### 2. Element Plus 组件
- `el-card` - 卡片容器
- `el-input` - 搜索框
- `el-radio-group` - 分类筛选
- `el-select` - 科目选择
- `el-dialog` - 详情弹窗
- `el-pagination` - 分页
- `el-empty` - 空状态

### 3. 响应式设计
```css
/* 桌面端：每行4个卡片 */
.grid-template-columns: repeat(auto-fill, minmax(300px, 1fr))

/* 移动端：每行1个卡片 */
@media (max-width: 768px) {
  .grid-template-columns: 1fr
}
```

### 4. 错误处理
```javascript
try {
  const data = await getStudentResources(params)
  resourcesData.value = data.records || []
} catch (error) {
  ElMessage.error('加载资源列表失败')
  resourcesData.value = []
}
```

## 完整功能清单

- [x] 学生资源搜索（关键词）
- [x] 分类筛选（课程/视频/试卷/其他）
- [x] 科目筛选（全科目）
- [x] 组合筛选（关键词+分类+科目）
- [x] 资源列表展示（卡片式）
- [x] 详情查看（模态框）
- [x] 自动浏览计数
- [x] 资源下载
- [x] 自动下载计数
- [x] 资源分享
- [x] 分享链接复制
- [x] 分页功能
- [x] 响应式设计
- [x] 空状态处理
- [x] 加载状态提示
- [x] 错误处理
- [x] 成功反馈

## 下一步建议

1. **功能增强**
   - 添加资源收藏功能
   - 添加下载历史记录
   - 添加资源评价/评分
   - 添加资源预览（在线预览）

2. **性能优化**
   - 搜索防抖（debounce）
   - 图片懒加载
   - 数据缓存

3. **用户体验**
   - 添加资源分类图标
   - 添加资源封面图
   - 添加批量下载
   - 添加资源推荐

---

**创建时间：** 2026-01-08
**创建人：** Claude Code
**版本：** 1.0
